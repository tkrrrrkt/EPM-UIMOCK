# 8つのブロッカーの視覚的サマリー

## 1. ブロッカー分類マトリックス

```
      |  技術問題  |  データ問題
------+----------+----------
優先度| #3,#5,#7 | #1,#2,#8
HIGH  |          | #1(連結/単体)
      |          | #2(Revenue)
      |          | #8(複数年度)
------+----------+----------
難度  | ✅ 低   | ⚠️ 高
期間  | 2-3w   | 2-4w
------+----------+----------
解決方| 実装     | 外部ツール
法   | 修正     | データ収集
```

---

## 2. データ充実度スコアカード

```
企業: 川田テクノロジーズ

┌─────────────────────────────────────┐
│  BS (貸借対照表)          [✅ 充実]  │
│  ├─ Assets (資産)       16項目      │
│  ├─ Liabilities (負債)   4項目      │
│  └─ NetAssets (純資産)  69項目      │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  PL (損益計算書)         [✅ 充実]  │
│  ├─ Revenue (売上)      14項目      │
│  ├─ COGS (売上原価)      2項目      │
│  └─ Net Income (純利益) 10項目      │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  CF (キャッシュフロー)   [✅ 充実]  │
│  ├─ CashFlow Items       2項目      │
│  ├─ Cash Equivalents    13項目      │
│  └─ Closing Cash         3項目      │
└─────────────────────────────────────┘

┌─────────────────────────────────────┐
│  多期間分析              [❌ 不可]  │
│  ├─ Document Count       1 (2021)   │
│  └─ YoY 分析            不可       │
└─────────────────────────────────────┘
```

---

## 3. 各ブロッカーの影響スコープ

### ブロッカー #1: is_consolidated = NULL (100%)

```
影響範囲:

  連結決算分析
      │
      ├─ ❌ グループ全体の収益性
      ├─ ❌ 親子会社の区別
      └─ ❌ 消去取引の除外

  セグメント分析
      │
      ├─ ❌ 地域別分析
      ├─ ❌ 事業部門別分析
      └─ ❌ 子会社別分析

  データクレンジング必須スコア: 9/10
```

---

### ブロッカー #2: Revenue = 0 (日本ロジテムのみ)

```
日本ロジテムのみ影響:

  基本分析不可
      │
      ├─ ❌ 売上高トレンド
      ├─ ❌ 粗利率分析
      ├─ ❌ ROE 計算
      └─ ❌ 市場シェア比較

  他社 (4社) への影響: なし

  影響範囲: 特定企業限定（20%）
  重要度: 高（基本指標不足）
```

---

### ブロッカー #3: Concept が 1,000+ 項目

```
データアクセス層の複雑性

  element_name 例:
  ├─ Assets (高位)
  ├─ CurrentAssets 
  ├─ AccountsReceivableTrade (低位)
  ├─ AccumulatedDepreciationMachineryEquipment
  └─ ... (1,000+ 種類)

  対策後:
  ├─ [Assets] → 正規化
  ├─ [Liabilities] → 正規化
  └─ [Equity] → 正規化
  
  影響: 実装の複雑度アップ
  解決可能性: ✅ 高
```

---

### ブロッカー #4: Decimal 値がそのまま保存

```
値の計算ルール

  xBRL 値: value_numeric = 147408, decimals = 6
  
  正しい値: 147408 * 10^6 = 147,408,000,000 円
  
  誤りやすいパターン:
  ├─ decimals を無視 → 147,408 (誤り)
  └─ decimals の符号を間違える → 0.147408 (誤り)
  
  影響範囲: すべての数値計算（100%）
  修正優先度: 高
```

---

### ブロッカー #5: Unit が NULL (20%)

```
Unit 分布

  JPY        5,071 facts (66%)   ✅
  (NULL)     1,544 facts (20%)   ⚠️ 未設定
  xbrli:pure   671 facts (9%)    ✅
  xbrli:shares 391 facts (5%)    ✅

  対策:
  ├─ value_text がある → テキスト値（OK）
  └─ value_numeric がある → Unit 補正が必要

  影響: 集計時の精度（低～中）
```

---

### ブロッカー #6: Context が 1,104 個

```
1ドキュメント = 5社 × 1期

  予想 Context: 5～10 個
  実際 Context: 1,104 個 ← 221 個/ドキュメント!

  原因: xBRL の全軸の組み合わせ
  ├─ 日本基準 / IFRS
  ├─ 連結 / 単体
  ├─ 部門別
  ├─ 通期 / 四半期
  └─ ... 組み合わせ爆発

  対策: Context Priority Filter
  ├─ ConsolidatedMember (最優先)
  ├─ StandaloneMember (2番目)
  └─ Others (除外)

  効果: Context 削減 1,104 → 10 程度に
```

---

### ブロッカー #7: is_nil = true (628 件, 8.2%)

```
nil フラグの分布

  is_nil = false: 7,049 facts (91.8%)  ✅ 有効
  is_nil = true:    628 facts (8.2%)   ⚠️ 値なし

  例:
  ├─ Element: SalesRevenueFromMerchandise
  ├─ Company: 売上なし企業
  └─ is_nil = true ← 「報告値がない」という意思表示

  対策: WHERE is_nil = false で自動除外

  影響: 集計精度（低）
```

---

### ブロッカー #8: Document が 1社 1件のみ

```
時系列データの不足

  現状:
  ┌─────────────────┐
  │ 企業別ドキュメント│
  ├─────────────────┤
  │ 川田テク   1件  │
  │ ロジテム   1件  │
  │ ほくやく   1件  │
  │ トーアミ   1件  │
  │ ＴＢＫ     1件  │
  └─────────────────┘
       （全て 2021 FY）

  必要な時系列:
  ┌───────────────────────┐
  │ FY2018 → FY2024       │
  │ 7年間のデータが必要   │
  └───────────────────────┘

  影響スコープ:
  ├─ ❌ YoY 分析
  ├─ ❌ CAGR 計算
  ├─ ❌ トレンド検出
  ├─ ❌ 成長性評価
  └─ ❌ 景気循環性分析

  対策: EDINET API で全期間再取込み
```

---

## 4. ブロッカー対処の優先順位フロー

```
発生順序        処理順序              難度     期間

START
  ↓
【ブロッカー #8】 → [PRIORITY 1] → 複数年度取込み → 2-4w
複数年度不足
  ↓
【ブロッカー #1】 → [PRIORITY 2] → 連結/単体判定 → 1-2w
is_consolidated
  ↓
【ブロッカー #2】 → [PRIORITY 3] → Revenue タグ検索 → 1-2w
売上不足
  ↓
【ブロッカー #4】 → [PRIORITY 4] → normalized_value追加 → 3-5d
Decimal補正
  ↓
【ブロッカー #6】 → [PRIORITY 5] → Context filtering → 5-7d
Context過多
  ↓
【ブロッカー #3,5,7】→ [PRIORITY 6] → 細粒度修正 → 3-5d
其他テクニカル
  ↓
END: 4～6週間で解決
```

---

## 5. 財務分析開始条件チェックリスト

```
分析種別              ブロッカー依存度    実行可否
─────────────────────────────────────────────────
BS 分析                LOW (#1)          ✅ 可能*
  ├─ 資産構成分析      
  ├─ 債務比率分析      
  └─ *連結/単体分離不可 (要#1修正)

─────────────────────────────────────────────────
PL 分析                HIGH (#2,#8)      ⚠️ 限定的
  ├─ 売上成長率        依存: #8          ❌ 不可(単期)
  ├─ 粗利率           依存: #2          ✅ 4社は可
  ├─ 営業利益率       独立              ✅ 可能
  └─ 純利益率         独立              ✅ 可能

─────────────────────────────────────────────────
CF 分析                MEDIUM (#1)       ✅ 概ね可能
  ├─ 営業CF            
  ├─ 投資CF            
  └─ 財務CF            

─────────────────────────────────────────────────
時系列分析             HIGH (#8)         ❌ 不可
  ├─ YoY              依存: #8          
  ├─ CAGR             依存: #8          
  ├─ トレンド         依存: #8          
  └─ 予測             依存: #8          

─────────────────────────────────────────────────
比較分析               MEDIUM (#1,#2)    ⚠️ 限定的
  ├─ 企業間比較        依存: #1,#2       ✅ 部分的
  ├─ 業種別比較        依存: #1,#2       ✅ 部分的
  └─ グループ分析      依存: #1          ❌ 不可

─────────────────────────────────────────────────

凡例: ✅=即実行 ⚠️=修正待ち ❌=必須修正
```

---

## 6. リスク評価マトリックス

```
ブロッカー | 発見難度 | 影響度 | 修正難度 | リスク
──────────┼────────┼──────┼────────┼──────
   #1     |  ⭐⭐⭐ | ⭐⭐⭐ |  ⭐⭐  | 🔴 高
   #2     |  ⭐⭐⭐ | ⭐⭐⭐ |  ⭐⭐  | 🔴 高
   #3     |  ⭐⭐  | ⭐⭐  |  ⭐   | 🟡 中
   #4     |  ⭐⭐⭐ | ⭐⭐⭐ |  ⭐   | 🟡 中
   #5     |  ⭐⭐  | ⭐   |  ⭐   | 🟢 低
   #6     |  ⭐⭐⭐ | ⭐⭐  |  ⭐⭐ | 🟡 中
   #7     |  ⭐⭐  | ⭐   |  ⭐   | 🟢 低
   #8     |  ⭐   | ⭐⭐⭐ |  ⭐⭐ | 🔴 高

総体的リスク: 🔴 HIGH
（#1, #2, #8 の3つのデータ問題が重大）
```

---

**作成日**: 2026-01-29
**対象DB**: PostgreSQL edinet
**テストデータ規模**: 5社 × 1期間 = 7,677 facts
