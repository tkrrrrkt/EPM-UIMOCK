# ディメンション管理 仕様概要

## 概要

EPM システムにおける多次元分析の基盤となるディメンション（分析軸）を管理する機能群。3層構造（軸定義・Group・Leaf）により、経営粒度での集計と詳細データの蓄積を両立する。

## 対象エンティティ

| エンティティ | 定義ファイル | 役割 |
|-------------|-------------|------|
| dimensions | `entities/01_各種マスタ.md` | ディメンション軸の定義 |
| dimension_values | `entities/01_各種マスタ.md` | Group レベル（経営粒度） |
| dimension_members | `entities/01_各種マスタ.md` | Leaf レベル（詳細コード） |
| dimension_member_groups | `entities/01_各種マスタ.md` | Leaf → Group 分類 |
| fact_dimension_links | `entities/01_各種マスタ.md` | ファクト → Group 付与 |

## 主要な仕様

### 3層ディメンション構造

```
dimensions (軸定義: 10件程度)
    │
    ├── dimension_values (Group: 数百件)
    │       │
    │       └── dimension_member_groups (分類マッピング)
    │               │
    │               └── dimension_members (Leaf: 数千〜数万件)
    │
    └── fact_dimension_links
            │
            └── fact_amounts
```

| レイヤー | テーブル | データ量 | 用途 |
|---------|---------|---------|------|
| 軸定義 | dimensions | 少 | 分析軸の種類定義 |
| Group | dimension_values | 中 | 経営レポート・集計軸 |
| Leaf | dimension_members | 多 | 外部システムコード蓄積 |

### ファクトとの関係

- **fact_amounts** は **dimension_values（Group）** にリンク
- Leaf レベルはファクトに直接リンクしない
- `fact_dimension_links` テーブル経由で Group を付与

### Leaf → Group 分類

- `dimension_member_groups` で Leaf を Group に分類
- 期間管理（valid_from, valid_to）により時点別分類に対応
- 同一 Leaf が期間によって異なる Group に所属可能

### 典型的なユースケース

1. **社員ディメンション**
   - Leaf: 社員コード（E001, E002, ...）
   - Group: 部門（営業部、開発部、...）
   - 分類: E001 → 営業部、E002 → 開発部

2. **プロジェクトディメンション**
   - Leaf: プロジェクトコード（PJ001, PJ002, ...）
   - Group: プロジェクト分類（研究開発、営業支援、...）

## 関連 Feature

- `.kiro/specs/master-data/dimension-master/` - ディメンションマスタ管理
- `.kiro/specs/planning/budget-entry/` - 予算入力（ディメンション選択）

## 検討経緯

- `.kiro/specs/仕様検討/ディメンション構造_20260109.md` - 3層構造の確認と役割整理

## 変更履歴

| 日付 | 変更内容 | 担当 |
|------|---------|------|
| 2026-01-09 | 初版作成 | Claude Code |
