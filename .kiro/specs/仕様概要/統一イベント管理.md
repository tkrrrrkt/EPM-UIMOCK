# 統一イベント管理機能

> **ステータス**: DRAFT（検討中）
> **作成日**: 2026-02-06
> **関連仕様**: なし（新規機能）

---

## 1. 機能概要

### 1.1 目的

EPMシステム内の各種イベント（予算・見込・会議・MTP・ガイドライン等）を**統一的なインターフェース**で一覧・管理できる機能。

### 1.2 解決する課題

| 課題 | 解決策 |
|------|--------|
| イベント種別ごとに別画面で管理 | 統一一覧画面で横断的に確認 |
| 登録状況確認が会議のみ | 予算・見込・会議で共通の登録状況画面 |
| 管理者が複数画面を行き来 | 1つの画面から各イベントにアクセス |

### 1.3 スコープ

| 項目 | Phase 1（今回） | Phase 2（将来） |
|------|----------------|----------------|
| イベント一覧表示 | ✅ | - |
| イベント詳細表示 | ✅ 基本情報のみ | 詳細コンテンツ |
| 登録状況管理 | ✅ | - |
| 既存画面への遷移 | ❌ 後回し | ✅ |
| イベント作成・編集 | ❌ | ✅ |

---

## 2. 対象イベント種別

| イベント種別 | コード | 登録状況管理 | 承認ワークフロー |
|-------------|--------|-------------|-----------------|
| 予算 | BUDGET | ✅ 対象 | ✅ あり（最大5段階） |
| 見込 | FORECAST | ✅ 対象 | ✅ あり（CORPORATE のみ） |
| 会議レポート | MEETING | ✅ 対象 | △ 簡易（提出→確認） |
| 中期経営計画 | MTP | ❌ 対象外 | ❌ なし |
| 予算ガイドライン | GUIDELINE | ❌ 対象外 | ❌ なし |
| KPI管理 | KPI_MASTER | ❌ 対象外 | ❌ なし |

※ 登録状況管理は「各部門が入力・提出するイベント」のみ対象

---

## 3. 画面構成

### 3.1 画面一覧

| ID | 画面名 | 概要 |
|----|--------|------|
| UE-01 | イベント一覧 | 全イベントの横断一覧 |
| UE-02 | イベント詳細 | イベントの詳細情報（タブ構成） |
| UE-03 | 登録状況タブ | 部門別の登録・承認状況 |

### 3.2 イベント一覧画面（UE-01）

```
┌─────────────────────────────────────────────────────────────────────┐
│ 【イベント管理】                                                     │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  種別: [全て ▼]  年度: [2026年度 ▼]  ステータス: [全て ▼]          │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  種別    イベント名                   対象期間    ステータス  進捗   │
│  ─────────────────────────────────────────────────────────────────  │
│  📋 予算  2026年度 当初予算           2026年度    受付中     45%    │
│  📈 見込  2026年1月 第3回見込         2026年1月   受付中     78%    │
│  🏢 会議  2026年1月 月次経営会議      2026年1月   準備中     30%    │
│  📊 MTP   2026-2028 中期経営計画      2026-2028   確定済     -      │
│  📝 GL    2026年度 予算ガイドライン   2026年度    配布済     -      │
│                                                                      │
│                                          [1] [2] [3] ... [10]       │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.3 イベント詳細画面（UE-02）

```
┌─────────────────────────────────────────────────────────────────────┐
│ ← 一覧へ戻る                                                         │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  【2026年度 当初予算】                                  ステータス   │
│                                                         受付中      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │ 種別: 予算                                                   │   │
│  │ 対象期間: 2026年4月〜2027年3月                               │   │
│  │ 締切日: 2026-03-15                                           │   │
│  │ 作成日: 2026-01-10                                           │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                      │
│  ┌────────────┬────────────┬────────────┐                          │
│  │  📄 概要   │ 📊 登録状況 │  📝 履歴   │                          │
│  └────────────┴────────────┴────────────┘                          │
│                                                                      │
│  （選択されたタブの内容が表示される）                                │
│                                                                      │
└─────────────────────────────────────────────────────────────────────┘
```

### 3.4 登録状況タブ（UE-03）

```
┌─────────────────────────────────────────────────────────────────────┐
│ 📊 登録状況                                                          │
├─────────────────────────────────────────────────────────────────────┤
│                                                                      │
│  ┌─────────────────────────────────────────────────────────────┐   │
│  │  進捗: ████████████░░░░░░░░░░░░░  45%    締切まで: 5日      │   │
│  │                                                              │   │
│  │  🔴 未着手: 5  🟡 入力中: 8  🟢 提出済: 12                   │   │
│  │  ✅ 承認済: 3  🔵 差戻し: 2                                  │   │
│  └─────────────────────────────────────────────────────────────┘   │
│                                                                      │
│  フィルタ: [ステータス ▼] [部門 ▼]              [🔔 催促] [📥 CSV] │
│                                                                      │
├─────────────────────────────────────────────────────────────────────┤
│  部門名              ステータス    最終更新    担当者    承認段階   │
│  ────────────────────────────────────────────────────────────────   │
│  営業本部            -            -           -         -          │
│  ├─ 営業1課         🔴 未着手     -           -         0/3        │
│  ├─ 営業2課         🟡 入力中     2026-03-10  田中太郎   0/3        │
│  ├─ 営業3課         🟢 提出済     2026-03-12  山田花子   1/3        │
│  └─ 営業4課         ✅ 承認済     2026-03-14  佐藤次郎   3/3        │
│  製造本部            -            -           -         -          │
│  ├─ 製造1課         🟢 提出済     2026-03-11  鈴木一郎   2/3        │
│  ...                                                                │
└─────────────────────────────────────────────────────────────────────┘
```

---

## 4. データソースマッピング

### 4.1 イベント種別ごとのデータソース

| 種別 | イベントテーブル | 登録状況テーブル | 承認テーブル |
|------|-----------------|-----------------|-------------|
| BUDGET | plan_versions (scenario_type='BUDGET') | department_approval_status | department_approval_histories |
| FORECAST | plan_versions (scenario_type='FORECAST') | department_approval_status | department_approval_histories |
| MEETING | meeting_events | meeting_submissions | - |
| MTP | mtp_events | - | - |
| GUIDELINE | guideline_events | - | - |

### 4.2 ステータスマッピング

各イベント種別のステータスを統一表示用にマッピング：

| 種別 | 元ステータス | 統一表示 |
|------|------------|---------|
| BUDGET/FORECAST | DRAFT | 下書き |
| BUDGET/FORECAST | SUBMITTED | 受付中 |
| BUDGET/FORECAST | APPROVED | 承認済 |
| BUDGET/FORECAST | FIXED | 確定済 |
| MEETING | DRAFT | 下書き |
| MEETING | OPEN | 受付開始 |
| MEETING | COLLECTING | 受付中 |
| MEETING | HELD | 開催済 |
| MEETING | CLOSED | 完了 |
| MTP | DRAFT | 下書き |
| MTP | CONFIRMED | 確定済 |
| GUIDELINE | DRAFT | 下書き |
| GUIDELINE | DISTRIBUTED | 配布済 |
| GUIDELINE | CLOSED | 完了 |

### 4.3 登録状況ステータスマッピング

| 統一ステータス | BUDGET/FORECAST | MEETING |
|--------------|-----------------|---------|
| NOT_STARTED | current_step=0, status=DRAFT | submission なし |
| IN_PROGRESS | current_step=0, status=DRAFT, updated_at あり | status=DRAFT |
| SUBMITTED | status=PENDING | status=SUBMITTED |
| APPROVED | status=APPROVED | status=APPROVED |
| REJECTED | status=REJECTED | - |
| OVERDUE | 締切超過 & 未提出 | 締切超過 & 未提出 |

---

## 5. 技術仕様

### 5.1 BFF エンドポイント

| メソッド | パス | 説明 |
|---------|------|------|
| GET | /bff/unified-events | イベント一覧取得 |
| GET | /bff/unified-events/:eventType/:eventId | イベント詳細取得 |
| GET | /bff/unified-events/:eventType/:eventId/submissions | 登録状況一覧取得 |
| POST | /bff/unified-events/:eventType/:eventId/remind | 催促メール送信 |

### 5.2 ディレクトリ構成

```
packages/contracts/src/bff/unified-events/
├── index.ts                    # コントラクト定義

apps/bff/src/modules/unified-events/
├── unified-events.module.ts
├── unified-events.controller.ts
├── unified-events.service.ts
└── adapters/
    ├── budget-adapter.ts       # 予算データ変換
    ├── forecast-adapter.ts     # 見込データ変換
    ├── meeting-adapter.ts      # 会議データ変換
    ├── mtp-adapter.ts          # MTPデータ変換
    └── guideline-adapter.ts    # ガイドラインデータ変換

apps/web/src/features/admin/unified-events/
├── api/
│   ├── BffClient.ts
│   ├── HttpBffClient.ts
│   └── MockBffClient.ts
├── components/
│   ├── UnifiedEventListPage.tsx
│   ├── UnifiedEventDetailPage.tsx
│   ├── EventInfoCard.tsx
│   ├── SubmissionStatusTab.tsx
│   ├── SubmissionSummaryCard.tsx
│   ├── SubmissionTable.tsx
│   └── ReminderDialog.tsx
└── hooks/
    ├── useUnifiedEvents.ts
    └── useSubmissionStatus.ts
```

---

## 6. Phase 1 実装範囲

### 6.1 含まれる機能

- [x] イベント一覧画面（フィルタ・ページネーション）
- [x] イベント詳細画面（基本情報表示）
- [x] 登録状況タブ（予算・見込・会議対応）
- [x] 登録状況サマリー表示
- [x] 部門別ステータス一覧
- [x] 催促機能（ダイアログ表示まで）
- [x] モックデータによる動作確認

### 6.2 含まれない機能（Phase 2 以降）

- [ ] 既存画面への遷移リンク
- [ ] イベント作成・編集機能
- [ ] 実際のAPI連携（Domain API）
- [ ] 催促メール送信の実処理
- [ ] CSV出力機能
- [ ] 履歴タブの実装

---

## 7. モックデータ仕様

### 7.1 イベントデータ

```typescript
const mockEvents: UnifiedEvent[] = [
  {
    id: 'budget-2026-v1',
    eventType: 'BUDGET',
    name: '2026年度 当初予算',
    targetPeriod: '2026年度',
    status: 'COLLECTING',
    statusLabel: '受付中',
    deadline: '2026-03-15',
    progress: { total: 30, completed: 14, rate: 47 }
  },
  {
    id: 'forecast-202601-v3',
    eventType: 'FORECAST',
    name: '2026年1月 第3回見込',
    targetPeriod: '2026年1月',
    status: 'COLLECTING',
    statusLabel: '受付中',
    deadline: '2026-01-25',
    progress: { total: 30, completed: 24, rate: 80 }
  },
  // ... 他のイベント
];
```

---

## 変更履歴

| 日付 | 変更内容 | 担当 |
|------|---------|------|
| 2026-02-06 | 初版作成（DRAFT） | Claude Code |
