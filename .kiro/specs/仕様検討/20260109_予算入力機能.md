# 予算入力機能 仕様検討（2026-01-09）

## 検討背景

予算・見込・実績の入力機能について、画面設計・操作フロー・データ構造を整理。PJ予算と部門予算の統合的な管理方法を検討。

---

## Q1: 画面設計方式

### 選択肢
- A案: 画面を分ける（部門予算画面 / PJ予算画面）
- B案: タブ切替
- C案: モード切替

### 決定
> モード切り替えがいいですね。

**C案（モード切替）** を採用。部門を起点に、[部門全体] / [PJ別] モードで切り替える。

---

## Q2: 予算レイアウト

### 質問
PJ予算と部門予算で同じレイアウトを使うか、別にするか。

### 回答（ユーザー）
> 基本的に予算のレイアウトは１年カンパニーキーで運用するのは一つの想定です。ただし、PJは別レイアウトでそれも会社単位一つ

### 決定
- **部門予算レイアウト**: 会社に1つ
- **PJ予算レイアウト**: 会社に1つ（別レイアウト）
- 科目体系は共通だが、表示する科目・並び順が異なる

---

## Q3: 入力粒度

### 質問
月次入力が基本か、年間一括入力もあるか。

### 回答（ユーザー）
> 月次入力が基本です

### 決定
**月次入力**を基本とする。

---

## Q4: 入力権限

### 質問
部門予算・PJ予算の入力権限をどう制御するか。

### 回答（ユーザー）
> 予算入力は基本権限が割り当たっている人がします。もしかしたら、部門予算は登録できないけど、PJ予算だけは登録できて、みれるという権限が必要かもしれないので、それは、UIで制御が必要かもしれません。
> 権限は、ロール、アカウント単位にベット設ける予定ですが、まだつまっていません。

### 決定
- 権限はロール・アカウント単位で制御（詳細は別途設計）
- UIで「部門予算: 不可 / PJ予算: 可」のケースを制御

---

## Q5: 予算と見込の切替

### 選択肢
- タブ切替
- シナリオ選択（ドロップダウン）
- バージョン選択

### 回答（ユーザー）
> タブ切り替えのほうがUI的にユーザーにとってはいいですかね。どうですか。バージョンもふくめて、UIUXのいいようにしたいです。

### 決定
シナリオとバージョンの組み合わせが多いため、**ドロップダウン方式**を採用。

```
[シナリオ] 当初予算 ▼   [バージョン] 第2回 ▼
```

---

## Q6: 見込の起点データ

### 選択肢
- A) 予算コピー
- B) 前月見込コピー
- C) 実績+予算

### 回答（ユーザー）
> 基本は【案B】前月見込コピーですね。（ただし実績がある部分は実績におきかえ。前より進んでいるケースがある）

### 追加要件
> PJについては、PJ管理ソフトで見込みを登録管理しているケースがあるのでそれはそれで取り込みできるほうがいいとおもったのです。

### 決定
- **標準**: 前月見込コピー + 実績確定月は実績置換
- **PJ見込**: 外部PJ管理ツールからの取込も可能
- 取込後、見込入力画面に反映

---

## Q7: 実績月の扱いと締め概念

### 回答（ユーザー）
> 実績月は基本入力不可。確定したら。仮締・本締の概念を持ちたいです。
> 一応実績も基本取り込みですが、入力も可能としたいので、入力かひ制御はさきほどの締め概念とからめて必要かなとおもっています。本締はダメとか。

### 決定
- **OPEN**: 入力可
- **SOFT_CLOSED（仮締め）**: 原則不可、権限者のみ可
- **HARD_CLOSED（本締め）**: 完全不可

---

## Q8: 調整・差異修正

### 回答（ユーザー）
> あとはそれとは別でファクトテーブルにありますが、原価差異修正や調整などもいれれるような機能を想定しています。

### 検討内容

#### 入力方法
| 案 | 内容 |
|----|------|
| A | 同一グリッド内で入力（自動判定） |
| B | 調整用の行を分ける |
| C | 調整モード切替 |

#### 表示方法
| 案 | 内容 |
|----|------|
| X | 合計のみ表示 |
| Y | 内訳表示（INPUT / ADJUST 別行） |

#### 調整理由
| 案 | 内容 |
|----|------|
| P | notes列に自由記述 |
| Q | 調整理由マスタを設ける |

### 決定
- 入力方法: **案B**（調整用の行を分ける）
- 表示方法: **案Y**（内訳表示）
- 調整理由: **案P**（Phase1はnotes、必要なら後でマスタ化）

---

## 確定事項まとめ

| 項目 | 決定内容 |
|------|---------|
| 画面方式 | モード切替（部門全体 / PJ別） |
| シナリオ・バージョン選択 | ドロップダウン |
| レイアウト | 部門用・PJ用で別（会社ごとに1つずつ） |
| 入力粒度 | 月次 |
| 権限 | ロール・アカウント単位（詳細別途） |
| 見込作成 | 前月見込コピー + 実績置換 |
| PJ見込 | 外部取込も可能 |
| 締め概念 | OPEN / SOFT_CLOSED / HARD_CLOSED |
| 調整入力 | 調整行を分けて表示、notes に理由記載 |

---

## 参加者

- ユーザー
- Claude Code

## 検討日

2026-01-09
