# KPI管理マスタ 仕様検討（壁打ち）

## 検討日
2026-01-25

## 検討目的
KPI管理マスタの詳細仕様を確定する。

## ⚠️ 重要
**この検討結果は確定版仕様書に反映されました。**
→ [KPI管理マスタ機能仕様_確定版.md](../仕様概要/KPI管理マスタ機能仕様_確定版.md)

以下は壁打ち検討の記録です。

---

## 1. 全体像の整理

### 1.1 基本コンセプト

```
┌─────────────────────────────────────────────────────────────┐
│  年度単位のKPI管理                                           │
│  ・年度開始前・途中でも設定可能                              │
│  ・財務/非財務/指標の3種類を統一管理                         │
│  ・部門別の閲覧権限                                         │
│  ・階層構造（KGI→KPI→アクションプラン）                     │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ KPI管理イベント（年度単位）                                  │
│ - FY2026 KPI管理                                            │
│ - FY2027 KPI管理                                            │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ KPI管理項目（財務/非財務/指標）                              │
│                                                             │
│ ┌────────────┐  ┌─────────────┐  ┌──────────────┐        │
│ │財務科目    │  │非財務KPI    │  │指標          │        │
│ │kpi_managed │  │kpi_         │  │kpi_managed   │        │
│ │=true       │  │definitions  │  │=true         │        │
│ └────────────┘  └─────────────┘  └──────────────┘        │
│       ↓               ↓                 ↓                  │
│   fact_amounts   kpi_fact_amounts   自動計算              │
│  (承認済予算等)   (目標・実績)      (予実管理なし)        │
└─────────────────────────────────────────────────────────────┘
                          ↓
┌─────────────────────────────────────────────────────────────┐
│ KPI一覧画面（パネル開閉式）                                  │
│ - 予実入力                                                  │
│ - 予実閲覧                                                  │
│ - アクションプラン登録                                      │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 画面構成イメージ

```
┌─────────────────────────────────────────────────────────────┐
│ KPI管理マスタ                                                │
├─────────────────────────────────────────────────────────────┤
│ [年度] 2026 ▼   [部門] 全社 ▼                [+ KPI項目追加] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│ KPI一覧（階層表示）                                          │
│                                                             │
│ ▼ KGI: 売上高（全社）                          [予実] [AP]  │
│   ├ KPI: 新規顧客売上（営業部）                [予実] [AP]  │
│   │  └ AP: 新規顧客開拓施策（営業1課）              [WBS]   │
│   └ KPI: 既存顧客売上（営業部）                [予実] [AP]  │
│                                                             │
│ ▼ KGI: CO2削減率（全社）                       [予実] [AP]  │
│   ├ KPI: 省エネ設備導入率（総務部）            [予実] [AP]  │
│   │  └ AP: LED照明導入（総務課）                    [WBS]   │
│   └ KPI: 社用車EV化率（管理部）                [予実] [AP]  │
│                                                             │
│ ▼ KGI: 営業利益率（全社）                      [指標] [AP]  │
│   └ KPI: 販管費削減率（経営企画部）            [予実] [AP]  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 仕様検討QA（壁打ち）

### Q1. KPI管理イベントの作成タイミング
**質問**: 年度のKPI管理イベントはいつ作成できるべきか？

**検討ポイント**:
- 年度開始前に作成可能か？
- 年度途中でも作成・変更可能か？
- 年度をまたいでの複製機能は必要か？

**回答案**:
```
✅ 採用案:
- 年度開始前でも作成可能
- 年度途中でも変更可能（ただし、既存データへの影響を考慮）
- 前年度からのコピー機能を提供（Phase 2）

理由:
- 年度開始前に計画を立てたいニーズがある
- 年度途中でのKPI追加・変更は現実的に発生する
- 前年度踏襲は業務効率化に寄与
```

**補足**:
- 年度途中でKPI項目を削除した場合、既存の予実データは論理削除（is_active=false）
- アクションプランは別途削除判断が必要

---

### Q2. KPI管理イベントのステータス管理
**質問**: KPI管理イベントにステータス（DRAFT/CONFIRMED）を持たせるべきか？

**検討ポイント**:
- ステータスの意味（編集可/編集不可）
- ステータス遷移のタイミング
- CONFIRMED後の変更可否

**回答案**:
```
✅ 採用案:
ステータス管理を実施

- DRAFT（編集可）
  - KPI項目の追加・編集・削除が自由
  - 予実入力も可能

- CONFIRMED（確定、編集制限あり）
  - KPI項目の削除は不可
  - KPI項目の追加は可能（年度途中の追加に対応）
  - 既存KPI項目の編集は可能（責任者変更等）
  - 予実入力は引き続き可能

理由:
- 年度開始時点でのKPI確定を明示化
- ただし、年度途中の変更も現実的に発生するため、柔軟性を残す
```

---

### Q3. KPI項目の3分類（財務/非財務/指標）
**質問**: 3分類それぞれでどのような違いがあるべきか？

**検討ポイント**:
- 予実データの持ち方
- 入力画面の違い
- 表示内容の違い

**回答案**:
```
✅ 採用案:

【財務科目】(kpi_type='FINANCIAL')
- 参照先: subjects (kpi_managed=true)
- 予実データ: fact_amounts
  - 承認済み予算・見込・実績を表示
  - レイアウトマスタ経由で入力
- KPI一覧画面: 予実表示のみ（入力は予算管理画面で実施）

【非財務KPI】(kpi_type='NON_FINANCIAL')
- 参照先: kpi_definitions
- 予実データ: kpi_fact_amounts
  - 目標・実績を入力
  - レイアウトマスタ不要
- KPI一覧画面: パネル開閉で目標・実績を直接入力可能

【指標】(kpi_type='METRIC')
- 参照先: metrics (kpi_managed=true)
- 予実データ: なし（構成要素から自動計算）
- KPI一覧画面: 計算結果の表示のみ（入力不可）

理由:
- 財務科目は既存の予算管理フローを活用
- 非財務KPIはシンプルな入力体験を提供
- 指標は自動計算により手間を削減
```

---

### Q4. KPI一覧画面のパネル開閉式UI
**質問**: パネル開閉式でどこまでの機能を提供すべきか？

**検討ポイント**:
- 開閉対象の情報
- インライン編集の範囲
- モーダル遷移の必要性

**回答案**:
```
✅ 採用案:

【閉じた状態】
- KPI名、種別（財務/非財務/指標）、責任部門、責任者
- 現在の達成率（簡易表示）
- [予実][AP]ボタン

【開いた状態】
┌─────────────────────────────────────────────────────┐
│ ▼ KPI: CO2削減率（非財務KPI）            [閉じる]   │
├─────────────────────────────────────────────────────┤
│ 責任部門: 総務部   責任者: 佐藤花子                 │
│                                                     │
│ 【目標・実績】                                      │
│ ┌──────┬─────┬──────┬──────┬────────┐           │
│ │ 期間 │ 単位│ 目標 │ 実績 │ 達成率 │           │
│ ├──────┼─────┼──────┼──────┼────────┤           │
│ │ Q1   │  %  │ 10.0 │  9.5 │  95%   │ [編集]  │
│ │ Q2   │  %  │ 12.0 │  -   │   -    │ [編集]  │
│ │ Q3   │  %  │ 15.0 │  -   │   -    │ [編集]  │
│ │ Q4   │  %  │ 20.0 │  -   │   -    │ [編集]  │
│ └──────┴─────┴──────┴──────┴────────┘           │
│ [+ 期間追加]                                        │
│                                                     │
│ 【アクションプラン】                                │
│ ┌────────────────┬─────┬────────┬────────┐       │
│ │ プラン名       │担当 │ 期限   │ 進捗   │       │
│ ├────────────────┼─────┼────────┼────────┤       │
│ │ 省エネ設備導入 │総務 │ 9/30   │ 40%    │[WBS] │
│ │ LED照明交換    │総務 │ 6/30   │ 80%    │[WBS] │
│ └────────────────┴─────┴────────┴────────┘       │
│ [+ アクションプラン追加]                            │
└─────────────────────────────────────────────────────┘

理由:
- 1画面で予実確認・入力・アクションプラン管理が完結
- 詳細情報は開閉で切り替え、画面遷移を最小限に
- 非財務KPIのみインライン編集可能（財務・指標は別画面）
```

---

### Q5. KPI階層構造の管理
**質問**: KPI階層（KGI→KPI→AP）をどのように実装すべきか？

**検討ポイント**:
- 階層の深さ（何階層まで許容するか）
- 階層の表現方法（parent_id方式 or level方式）
- 積み上げ集計の有無

**回答案**:
```
✅ 採用案:

【階層定義】
- 3階層固定
  - Level 1: KGI（全社レベル）
  - Level 2: KPI（事業部レベル）
  - Level 3: アクションプラン（部・課レベル）

【エンティティ設計】
kpi_master_items に以下を追加:
- parent_kpi_item_id (uuid, nullable) - 親KPI項目
- hierarchy_level (int, NOT NULL) - 階層レベル（1/2/3）
- department_stable_id (varchar(50), nullable) - 責任部門

【制約】
- Level 1（KGI）: parent_kpi_item_id = NULL, department_stable_id = NULL（全社）
- Level 2（KPI）: parent_kpi_item_id = KGI.id, department_stable_id = 事業部
- Level 3（AP）: parent_kpi_item_id = KPI.id, department_stable_id = 部・課

【積み上げ集計】
- Phase 1: 積み上げ集計なし（階層構造のみ）
- Phase 2: 自動積み上げ機能を検討

理由:
- 3階層で多くの企業のKPI管理に対応可能
- parent_id方式で柔軟性を確保
- 積み上げ集計は後回し（性質が異なるKPI間の集計は困難）
```

**補足**:
Level 3（アクションプラン）は、kpi_master_items に登録するのではなく、
action_plans テーブルで管理する方が適切かもしれない。

→ **要再検討**: Level 3をどちらで管理するか

---

### Q6. 部門別の閲覧権限
**質問**: 部門ごとにKPIの閲覧権限をどのように制御すべきか？

**検討ポイント**:
- 全社KPIは全員が閲覧可能か？
- 事業部KPIは当該事業部のみ閲覧可能か？
- 上位部門は下位部門のKPIを閲覧可能か？

**回答案**:
```
✅ 採用案:

【閲覧権限ルール】
1. 全社KPI（Level 1, department_stable_id=NULL）
   - 全員が閲覧可能

2. 事業部KPI（Level 2）
   - 当該事業部の所属者が閲覧可能
   - 上位部門（親部門）の所属者も閲覧可能
   - 経営企画等の管理部門は全部門閲覧可能（権限設定）

3. 部・課KPI（Level 3）
   - 当該部・課の所属者が閲覧可能
   - 上位部門（親部門）の所属者も閲覧可能
   - 管理部門は全部門閲覧可能（権限設定）

【実装方法】
- コントロール部門（employees.control_department_stable_ids）を使用
- 階層的な部門管理（organization_versions）を活用
- 権限: epm.kpi.admin（全社閲覧可）、epm.kpi.read（所属部門のみ）

理由:
- 上位部門が下位部門を管理するのは自然
- 管理部門の全体閲覧ニーズに対応
- RLSで制御可能
```

---

### Q7. KPI項目の責任部門・責任者
**質問**: 責任部門・責任者は必須か？任意か？

**検討ポイント**:
- 全社KPIの責任者（CEO等）を設定すべきか？
- 責任者未設定の場合の扱い

**回答案**:
```
✅ 採用案:

【必須/任意の設定】
- 責任部門: 任意（NULL=全社）
- 責任者: 任意（NULL=未設定）

【レベル別の推奨設定】
- Level 1（KGI）: 責任部門=NULL（全社）、責任者=経営層（任意）
- Level 2（KPI）: 責任部門=必須、責任者=部門長（推奨）
- Level 3（AP）: 責任部門=必須、責任者=担当者（推奨）

理由:
- 柔軟性を持たせるため任意とする
- ただし、Level 2/3では責任明確化のため設定を推奨
- UIで未設定時の警告表示を検討
```

---

### Q8. 年度途中でのKPI項目追加・削除
**質問**: 年度途中でKPI項目を追加・削除した場合の挙動は？

**検討ポイント**:
- 既存の予実データの扱い
- アクションプランの扱い
- 削除の場合の復元可否

**回答案**:
```
✅ 採用案:

【追加の場合】
- いつでも追加可能
- 追加時点から予実入力・アクションプラン登録が可能
- 過去期間の予実を遡って入力することも可能

【削除の場合】
- 論理削除（is_active=false）
- 既存の予実データは保持（閲覧可能）
- アクションプランは「削除されたKPIに紐付くプラン」として警告表示
- 復元機能を提供（is_active=true に戻す）

【変更の場合】
- KPI名、責任者等の変更は自由
- KPI種別（財務/非財務/指標）の変更は不可
- 参照先（科目ID等）の変更は不可

理由:
- 年度途中の変更は現実的に発生する
- データの整合性を保つため、種別変更は不可
- 論理削除で履歴保持・復元対応
```

---

### Q9. 非財務KPIの期間設定の自由度
**質問**: 非財務KPIの期間コードをどこまで自由に設定できるようにすべきか？

**検討ポイント**:
- 期間コードのフォーマット制限
- 期間の重複チェック
- 集計方法（SUM/AVG/EOP）との整合性

**回答案**:
```
✅ 採用案:

【期間コードのルール】
- テキスト自由入力（最大32文字）
- フォーマット制限なし（"2026-Q1", "2026-04", "2026-H1", "2026-ANNUAL" 等）
- 同一KPI内での期間コード重複は不可

【推奨フォーマット】
- 年度-期間 形式を推奨（例: "2026-Q1", "2026-04"）
- UIでプリセット選択肢を提供（Q1～Q4, 01～12, H1/H2, ANNUAL）

【期間の重複チェック】
- 期間コードの一意性のみチェック
- 期間の日付範囲（period_start_date, period_end_date）の重複は許容

【集計方法との整合性】
- SUM: 各期間の値を合計（年計に反映）
- AVG: 各期間の値を平均（年計に反映）
- EOP: 最終期間の値（年計は最終期間値）
- MAX/MIN: 年計は非表示

理由:
- 企業ごとに期間の区切り方が異なる（月次/四半期/半期等）
- 柔軟性を持たせることで幅広いニーズに対応
- ただし、UIで推奨フォーマットを提示して入力しやすく
```

---

### Q10. 財務科目の予実表示
**質問**: 財務科目をKPI管理対象にした場合、予実の表示はどうすべきか？

**検討ポイント**:
- どのバージョンの予算を表示するか？
- 見込・実績の表示方法
- 複数会社の場合の扱い

**回答案**:
```
✅ 採用案:

【表示する予実データ】
- 予算: 最新の承認済み（APPROVED or FIXED）バージョンを表示
- 見込: 最新バージョンを表示
- 実績: 最新の実績を表示
- 期間: 会計年度の期間（accounting_periods）

【表示内容】
┌──────────┬─────┬──────┬──────┬──────┬────────┐
│ 期間     │単位 │ 予算 │ 見込 │ 実績 │ 達成率 │
├──────────┼─────┼──────┼──────┼──────┼────────┤
│ 2026-04  │百万 │ 100  │ 95   │ 90   │  90%   │
│ 2026-05  │百万 │ 100  │ 95   │ -    │   -    │
│ ...      │     │      │      │      │        │
├──────────┼─────┼──────┼──────┼──────┼────────┤
│ 年計     │百万 │1200  │1140  │ 90   │  8%    │
└──────────┴─────┴──────┴──────┴──────┴────────┘

【入力】
- KPI一覧画面では入力不可
- 「予算管理画面へ」リンクを提供

理由:
- 承認済み予算を基準とするのが自然
- 財務科目は既存の予算管理フローを活用
- KPI一覧画面はあくまで「閲覧・モニタリング」が主目的
```

---

### Q11. 指標の計算結果表示
**質問**: 指標をKPI管理対象にした場合、計算結果をどのように表示すべきか？

**検討ポイント**:
- 計算タイミング（リアルタイム or バッチ）
- 構成要素の表示
- 目標値の設定

**回答案**:
```
✅ 採用案:

【表示内容】
┌──────────┬─────┬──────┬──────┐
│ 期間     │単位 │ 実績 │ 目標 │
├──────────┼─────┼──────┼──────┤
│ 2026-04  │  %  │  8.5 │ 10.0 │
│ 2026-05  │  %  │  8.3 │ 10.0 │
│ ...      │     │      │      │
├──────────┼─────┼──────┼──────┤
│ 年計     │  %  │  8.4 │ 10.0 │
└──────────┴─────┴──────┴──────┘

【計算タイミング】
- リアルタイム計算（画面表示時）
- metrics の formula に基づいて計算

【構成要素の表示】
- パネル開閉時に構成要素を表示
  - 営業利益: 85百万円（実績）
  - 売上高: 1,000百万円（実績）
  - 計算式: （営業利益 / 売上高）× 100

【目標値の設定】
- 指標自体の目標値を kpi_master_items.target_value として保持
- 期間ごとの目標値は kpi_target_values テーブルで管理

理由:
- 指標は自動計算により最新値を提供
- 構成要素の表示でドリルダウン可能
- 目標値設定でKPI管理の対象として機能
```

**補足**:
指標の目標値管理のため、新規エンティティが必要

→ **要検討**: kpi_target_values テーブルの設計

---

### Q12. アクションプラン登録のタイミング
**質問**: KPI項目登録とアクションプラン登録のタイミングは？

**検討ポイント**:
- KPI項目登録と同時にアクションプラン登録可能か？
- アクションプラン登録の必須/任意

**回答案**:
```
✅ 採用案:

【登録タイミング】
1. KPI項目を先に登録
2. その後、アクションプランを任意で登録

【アクションプランの必須/任意】
- 任意（アクションプランなしのKPIも可）
- KPI一覧画面から「+ アクションプラン追加」で登録

【登録フロー】
KPI一覧画面
  ↓ [+ アクションプラン追加]
アクションプラン登録画面
  ↓ 登録
KPI一覧画面（更新）

理由:
- KPI設定とアクションプラン策定は別タイミングの場合がある
- 全てのKPIにアクションプランが必要とは限らない
- 柔軟性を持たせる
```

---

## 3. エンティティ設計（確定版）

### 3.1 kpi_master_events（KPI管理イベント）

```sql
CREATE TABLE kpi_master_events (
    id uuid PRIMARY KEY,
    tenant_id uuid NOT NULL,
    company_id uuid NOT NULL,
    event_code varchar(50) NOT NULL,
    event_name varchar(200) NOT NULL,
    fiscal_year int NOT NULL,
    status varchar(20) NOT NULL DEFAULT 'DRAFT',
    is_active boolean NOT NULL DEFAULT true,
    created_at timestamptz NOT NULL DEFAULT now(),
    updated_at timestamptz NOT NULL DEFAULT now(),
    created_by uuid,
    updated_by uuid,

    CONSTRAINT kpi_master_events_tenant_code_uk
        UNIQUE(tenant_id, company_id, event_code),
    CONSTRAINT kpi_master_events_company_fk
        FOREIGN KEY(tenant_id, company_id)
        REFERENCES companies(tenant_id, id),
    CONSTRAINT kpi_master_events_status_ck
        CHECK(status IN ('DRAFT', 'CONFIRMED'))
);
```

### 3.2 kpi_master_items（KPI管理項目）

```sql
CREATE TABLE kpi_master_items (
    id uuid PRIMARY KEY,
    tenant_id uuid NOT NULL,
    kpi_event_id uuid NOT NULL,
    parent_kpi_item_id uuid,               -- 親KPI項目（階層構造用）
    kpi_code varchar(50) NOT NULL,
    kpi_name varchar(200) NOT NULL,
    kpi_type varchar(20) NOT NULL,
    hierarchy_level int NOT NULL,          -- 1:KGI, 2:KPI, 3:AP（要検討）
    ref_subject_id uuid,
    ref_kpi_definition_id uuid,
    ref_metric_id uuid,
    department_stable_id varchar(50),      -- 責任部門
    owner_employee_id uuid,                -- 責任者
    target_value numeric,                  -- 指標の目標値（指標のみ）
    sort_order int NOT NULL DEFAULT 1,
    is_active boolean NOT NULL DEFAULT true,
    created_at timestamptz NOT NULL DEFAULT now(),
    updated_at timestamptz NOT NULL DEFAULT now(),

    CONSTRAINT kpi_master_items_event_code_uk
        UNIQUE(tenant_id, kpi_event_id, kpi_code),
    CONSTRAINT kpi_master_items_event_fk
        FOREIGN KEY(tenant_id, kpi_event_id)
        REFERENCES kpi_master_events(tenant_id, id),
    CONSTRAINT kpi_master_items_parent_fk
        FOREIGN KEY(tenant_id, parent_kpi_item_id)
        REFERENCES kpi_master_items(tenant_id, id),
    CONSTRAINT kpi_master_items_subject_fk
        FOREIGN KEY(tenant_id, ref_subject_id)
        REFERENCES subjects(tenant_id, id),
    CONSTRAINT kpi_master_items_definition_fk
        FOREIGN KEY(tenant_id, ref_kpi_definition_id)
        REFERENCES kpi_definitions(tenant_id, id),
    CONSTRAINT kpi_master_items_metric_fk
        FOREIGN KEY(tenant_id, ref_metric_id)
        REFERENCES metrics(tenant_id, id),
    CONSTRAINT kpi_master_items_employee_fk
        FOREIGN KEY(tenant_id, owner_employee_id)
        REFERENCES employees(tenant_id, id),
    CONSTRAINT kpi_master_items_type_ck
        CHECK(kpi_type IN ('FINANCIAL', 'NON_FINANCIAL', 'METRIC')),
    CONSTRAINT kpi_master_items_level_ck
        CHECK(hierarchy_level IN (1, 2, 3)),
    CONSTRAINT kpi_master_items_ref_ck
        CHECK(
            (kpi_type = 'FINANCIAL' AND ref_subject_id IS NOT NULL
                AND ref_kpi_definition_id IS NULL AND ref_metric_id IS NULL)
            OR (kpi_type = 'NON_FINANCIAL' AND ref_subject_id IS NULL
                AND ref_kpi_definition_id IS NOT NULL AND ref_metric_id IS NULL)
            OR (kpi_type = 'METRIC' AND ref_subject_id IS NULL
                AND ref_kpi_definition_id IS NULL AND ref_metric_id IS NOT NULL)
        )
);
```

### 3.3 kpi_target_values（指標の目標値）【新規検討】

```sql
CREATE TABLE kpi_target_values (
    id uuid PRIMARY KEY,
    tenant_id uuid NOT NULL,
    kpi_master_item_id uuid NOT NULL,
    period_code varchar(32) NOT NULL,
    target_value numeric NOT NULL,
    created_at timestamptz NOT NULL DEFAULT now(),
    updated_at timestamptz NOT NULL DEFAULT now(),

    CONSTRAINT kpi_target_values_uk
        UNIQUE(tenant_id, kpi_master_item_id, period_code),
    CONSTRAINT kpi_target_values_item_fk
        FOREIGN KEY(tenant_id, kpi_master_item_id)
        REFERENCES kpi_master_items(tenant_id, id)
);
```

**補足**: 指標の期間ごとの目標値を管理するテーブル

---

## 4. 残検討事項

### 4.1 Level 3（アクションプラン）の管理方法

**選択肢A**: kpi_master_items で管理（階層の一部として）
- メリット: KPI階層が統一的
- デメリット: アクションプラン特有の情報（WBS、タスク等）との関連が複雑

**選択肢B**: action_plans テーブルで管理（別エンティティ）
- メリット: アクションプラン機能と自然に連携
- デメリット: KPI階層が kpi_master_items と action_plans に分散

→ **要検討**: どちらの方針が適切か

**暫定案**: 選択肢Bを採用
- Level 1/2 は kpi_master_items で管理
- Level 3（アクションプラン）は action_plans で管理
- action_plans.kpi_master_item_id で紐付け

---

### 4.2 指標の目標値管理の詳細設計

**検討ポイント**:
- kpi_master_items.target_value（年間目標）で十分か？
- 期間ごとの目標値が必要か？
- 期間ごとの目標値は kpi_target_values で管理するか？

→ **要検討**: Phase 1では年間目標のみとし、Phase 2で期間別目標を検討

---

### 4.3 KPI一覧画面の部門フィルタUI

**検討ポイント**:
- 部門ツリー表示 vs ドロップダウン
- 複数部門の同時表示
- デフォルトフィルタ（所属部門 or 全社）

→ **要検討**: UI設計フェーズで詳細化

---

### 4.4 前年度からのコピー機能

**検討ポイント**:
- どこまでコピーするか（KPI項目のみ？アクションプランも？）
- 予実データはコピーしない（新年度は空）
- コピー時の責任者・部門の引き継ぎ

→ **Phase 2検討**

---

## 5. 次のステップ

### 5.1 仕様確定が必要な項目

1. ✅ Level 3（アクションプラン）の管理方法 → 選択肢Bで進める
2. ⚠️ 指標の目標値管理 → Phase 1は年間目標のみ
3. ⚠️ KPI一覧画面のUI詳細 → 別途UI設計

### 5.2 実装順序

1. エンティティ作成
   - kpi_master_events
   - kpi_master_items
   - kpi_target_values（Phase 2）

2. UseCase/Repository実装
   - KPI管理イベント CRUD
   - KPI管理項目 CRUD
   - 階層管理ロジック
   - 権限チェックロジック

3. UI実装
   - KPI管理マスタ一覧画面
   - KPI項目追加/編集モーダル
   - KPI一覧画面（パネル開閉式）

---

## 6. 関連ドキュメント

- `.kiro/specs/仕様概要/KPIアクションプラン管理_変更案.md`
- `.kiro/specs/仕様概要/KPI管理_エンティティ変更サマリ.md`
- `.kiro/specs/仕様概要/KPI管理_UI設計変更サマリ.md`
- `.kiro/specs/仕様概要/新規画面・制御一覧_20260122整理.md`
